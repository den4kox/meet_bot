version: '3'
services:
  proxy:
    image: 'jwilder/nginx-proxy'
    container_name: 'proxy'
    ports:
      - '80:80'
      - '443:443'
    volumes:
      - 'nginx-vhosts:/etc/nginx/vhost.d'
      - 'nginx-config:/etc/nginx/conf.d'
      - 'nginx-certs:/etc/nginx/certs'
      - 'nginx-webroot:/usr/share/nginx/html'

  letsencrypt:
    image: 'jrcs/letsencrypt-nginx-proxy-companion'
    container_name: 'letsencrypt'
    volumes:
      - '/var/run/docker.sock:/var/run/docker.sock:ro'
      - 'nginx-vhosts:/etc/nginx/vhost.d'
      - 'nginx-config:/etc/nginx/conf.d'
      - 'nginx-certs:/etc/nginx/certs'
      - 'nginx-webroot:/usr/share/nginx/html'

  app1:
    image: nginx
    container_name: app1
    environment:
      VIRTUAL_HOST: api.shoxel.com
      LETSENCRYPT_HOST: api.shoxel.com
      LETSENCRYPT_EMAIL: 'admin@example.com'

  app:
    build: ./images/php-fpm
    ports:
      - "80:9000"
    links:
      - db
    volumes:
      - ../:/var/www/
    working_dir:
      /var/www/meetbot
    environment:
      VIRTUAL_HOST: shoxel.com
      LETSENCRYPT_HOST: shoxel.com
      LETSENCRYPT_EMAIL: 'admin@example.com'

  db:
    image: mysql:5.7
    ports:
      - "3306:3306"
    volumes:
      - mysql-data:/var/lib/mysql
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: meet
      MYSQL_USER: user
      MYSQL_PASSWORD: user
  phpmyadmin:
    image: phpmyadmin/phpmyadmin
    container_name: phpmyadmin
    environment:
     - PMA_ARBITRARY=1
    restart: always
    ports:
     - 8080:80
    volumes:
     - mysql-data:/var/lib/mysql

volumes:
  nginx-vhosts:
  nginx-config:
  nginx-certs:
  nginx-webroot:
  mysql-data: